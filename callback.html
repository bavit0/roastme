<!DOCTYPE html>
<html>
<body>
<script>
const TOKEN_KEY = "gh_token";

// Utility function to save token with expiry
function saveToken(token) {
  const expiry = Date.now() + 60 * 60 * 500; // 30 mins
  const obj = { token, expiry };
  sessionStorage.setItem(TOKEN_KEY, JSON.stringify(obj));
}

// Get OAuth code from URL
const params = new URLSearchParams(window.location.search);
const code = params.get("code");

if (!code) {
  document.body.innerText = "No code found!";
} else {
  fetch("https://roastme-backend.netlify.app/.netlify/functions/auth", {
    method: "POST",
    body: `code=${code}`,
  })
    .then(r => r.json())
    .then(data => {
      const token = data.access_token;
      if (!token) throw new Error("No access token returned");

      // Save token in sessionStorage
      saveToken(token);
      console.log("Token saved in sessionStorage for 30 min:", token);

    })
    .then(r => r.json())
    .then(console.log)
    .catch(console.error);
}
</script>
</body>
</html>
